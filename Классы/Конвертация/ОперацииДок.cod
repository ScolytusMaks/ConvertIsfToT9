class "Импорт расчетных листков и ведомостей";
  import СИС2                   classes ФункцииДокумента;
  import ТББ_Базовый            classes Библио;
  import Бюджет_ЗПиДД           classes Константы;

inclass

--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--
  func ЗагруженоВсе:logical;
--    with Query.Create([Бюджет_ЗПиДД.РасчетныеОперации.Начисление]) do
--      Filter    = 'OurINN="'+Переменные.ИНН+'"';
--      Select;
--      Result    = not (Bof and Eof);
--    end;--with Query
  end;--func ЗагруженоВсе
--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--
  proc Импорт_РВЕД;
    var локПодшивка     : Бюджет_ЗПиДД.РасчетныеОперации.Подшивка;
    with Query.Create([ИСФ_КонверторИзЗарплаты.ТБ69.ISF_РВЕД]) do
      Filter            = 'ДАТК<>nil and ДАТК<'+Str(КонвертерИзТБ.ДатаНачалаРасчетовТ9)+' and ДАТН>=01.01.2012';
      Select;
      while not Eof do
        локПодшивка     = QueryRecord(Бюджет_ЗПиДД.РасчетныеОперации.Подшивка,'OurINN="'+Переменные.ИНН+'" and UKeyT6='+Str(Current.DocId)) as Бюджет_ЗПиДД.РасчетныеОперации.Подшивка;
        if локПодшивка=nil then
          локПодшивка   = Бюджет_ЗПиДД.РасчетныеОперации.Подшивка.Create;
        end;
        --локПодшивка.Завершен            = true;
        локПодшивка.НашеУчреждение      = Переменные.ЗагруженноеУчреждение;
        локПодшивка.НомерБум            = PadL(Str(Current.Номер),5,'0');
        локПодшивка.Описание            = 'Подшивка расчетов';--if(Current.ТИПВЕД=0,ТипыРасчета[2,2],ТипыРасчета[3,2]) as string;
        локПодшивка.Валюта              = ВзятьБазовуюВалюту;
        локПодшивка.УчетныйПериод       = QueryRecord(Бюджет_ЗПиДД.Справочники.ПериодыУчета,'НашеУчреждение='+Str(Переменные.ЗагруженноеУчреждение)+' and КОД="'+Current.КОДПЕР as string+'"') as Бюджет_ЗПиДД.Справочники.ПериодыУчета;
        локПодшивка.Дата                = Current.ДАТАР as date;
        локПодшивка.ДатаУчета           = Current.ДАТАР as date;
        локПодшивка.ДатаРасчета         = Current.ДАТАР as date;
        локПодшивка.ТипРасчета          = (Current.ТИПВЕД as integer)+1;
        локПодшивка.РасчетныйПериод     = QueryRecord(ТББ_Базовый.Справочники.ПериодыРасчета,'КОД="'+Current.КОДПЕР as string+'"') as ТББ_Базовый.Справочники.ПериодыРасчета;
        локПодшивка.ДатаНачала          = Current.ДАТН as date;
        локПодшивка.ДатаОкончания       = Current.ДАТК as date;
        локПодшивка.Комментарий         = Current.Комментарий as string;
        локПодшивка.OurINN              = Переменные.ИНН;
        локПодшивка.UKeyT6              = Current.DocId as integer;
        RecordPostIfNeed(локПодшивка);
        Next;
      end;--
    end;--with Query
  end;--proc Импорт_РВЕД
--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--
  proc Импорт_РЛ;
    var локРЛ           : Бюджет_ЗПиДД.РасчетныеОперации.Расчет;
    with Query.Create([ИСФ_КонверторИзЗарплаты.ТБ69.ISF_РЛ]) do
--      Filter            = 'ДАТК<>nil and ДАТК<'+Str(КонвертерИзТБ.ДатаНачалаРасчетовТ9)+' and ДАТН>=01.01.2012';
--      Select;
--      while not Eof do
--        локПодшивка     = QueryRecord(Бюджет_ЗПиДД.РасчетныеОперации.Подшивка,'OurINN="'+Переменные.ИНН+'" and UKeyT6='+Str(Current.DocId)) as Бюджет_ЗПиДД.РасчетныеОперации.Подшивка;
--        if локПодшивка=nil then
--          локПодшивка   = Бюджет_ЗПиДД.РасчетныеОперации.Подшивка.Create;
--        end;
--        --локПодшивка.Завершен            = true;
--        локПодшивка.НашеУчреждение      = Переменные.ЗагруженноеУчреждение;
--        локПодшивка.Подразделение       = QueryRecord(Базовый.Данные.Субъект,'Подразделение and Субъект='+Str(Переменные.ЗагруженноеУчреждение)+' and CodeISF="'+Current.КОДПОДР as string+'"') as Базовый.Данные.Субъект;
--        локПодшивка.НомерБум            = PadL(Str(Current.Номер),5,'0');
--        локПодшивка.Описание            = 'Подшивка расчетов';--if(Current.ТИПВЕД=0,ТипыРасчета[2,2],ТипыРасчета[3,2]) as string;
--        локПодшивка.Валюта              = ВзятьБазовуюВалюту;
--        локПодшивка.УчетныйПериод       = QueryRecord(Бюджет_ЗПиДД.Справочники.ПериодыУчета,'НашеУчреждение='+Str(Переменные.ЗагруженноеУчреждение)+' and КОД="'+Current.КОДПЕР as string+'"') as Бюджет_ЗПиДД.Справочники.ПериодыУчета;
--        локПодшивка.Дата                = Current.ДАТАР as date;
--        локПодшивка.ДатаУчета           = Current.ДАТАР as date;
--        локПодшивка.ДатаРасчета         = Current.ДАТАР as date;
--        локПодшивка.ТипРасчета          = (Current.ТИПВЕД as integer)+1;
--        локПодшивка.РасчетныйПериод     = QueryRecord(ТББ_Базовый.Справочники.ПериодыРасчета,'КОД="'+Current.КОДПЕР as string+'"') as ТББ_Базовый.Справочники.ПериодыРасчета;
--        локПодшивка.ДатаНачала          = Current.ДАТН as date;
--        локПодшивка.ДатаОкончания       = Current.ДАТК as date;
--        локПодшивка.Комментарий         = Current.Комментарий as string;
--        локПодшивка.OurINN              = Переменные.ИНН;
--        локПодшивка.UKeyT6              = Current.DocId;
--        RecordPostIfNeed(локПодшивка);
--        Next;
--      end;--
    end;--with Query
  end;--proc Импорт_РЛ
--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--
  proc Выполнение;
    Импорт_РВЕД;
    Импорт_РЛ;
  end;--proc Выполнение
--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--

inobject

end