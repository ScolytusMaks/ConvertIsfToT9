--@ClassDoc В "Зарплате" ИСФ понятия бюджета и КБК не разделялись.
--@ClassDoc В связи с этим при импорте количество бюджетов всегда равно кол-ву КБК
--@ClassDoc
class "";

inclass
--188.0302.2025800.014.1


--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--
  func Загружено        (локКодИф:string):logical;
    with Query.Create([Бюджет_ЗПиДД.Справочники.ВидыБюджета]) do
      Filter    = 'НашеУчреждение='+Str(Переменные.ЗагруженноеУчреждение)+' and CodeISF="'+локКодИф+'"';
      Select;
      Result    = not (Bof and Eof);
      Close;
    end;--with Query
  end;--func Загружено
--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--
  func ЗагруженоВсе:logical;
    Result      = true;
    with Query.Create([ТБ69.ISF_ИСТФИН]) do
      Select;
      while not Eof do
        if not Загружено(Current.Код as string) then
          Result                = false;
          Break;
        end;
        Next;
      end;--while not Eof
    end;--with Query
  end;--func ЗагруженоВсе

--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--
  func Выполнение:integer;
    var локРабКбк       : ТББ_Базовый.Справочники.РабочиеКБК;
    var локСтр          : string;
    var локВфо          : integer;
    var newRecord       : Бюджет_ЗПиДД.Справочники.ВидыБюджета;
    with Query.Create([ТБ69.ISF_ИСТФИН]) do
      Select;
      while not Eof do
        if not Загружено(Current.КОД as string) then
          if Конвертация.КБК.Загружено(Current.Код as string,локРабКбк)  then
            --попытка определить код вида финансового обеспечения
            локСтр              = SubStr(Current.КОД as string,Length(Current.КОД as string),1);
            if локСтр in ['1','2','3','4','5','6','7','8'] then
              локВфо            = Int(локСтр);
            else
              локВфо            = 1;
            end;
            --создание записи
            newRecord                   = Бюджет_ЗПиДД.Справочники.ВидыБюджета.Create;
            newRecord.Код               = ТББ_Базовый.Нумератор.НовыйКод(newRecord);
            newRecord.Имя               = Current.Наим as string;
            newRecord.Наим              = Current.Наим as string;
            newRecord.НашеУчреждение    = Переменные.ЗагруженноеУчреждение;
            newRecord.КБК               = локРабКбк;
            newRecord.КВФО              = локВфо;
            newRecord.СистемаНО         = СИС2.ФункцииДокумента.QueryRecord(Бюджет_ЗПиДД.Справочники.СистемыНалогообложения,'Наим="Общая система налогообложения"') as Бюджет_ЗПиДД.Справочники.СистемыНалогообложения;
            newRecord.CodeISF           = Current.КОД as string;
            newRecord.Post;
          end;--if Конвертация.КБК.Загружено
        end;--if not Загружено
        Next;
      end;--while not Eof
    end;--with Query
    if ЗагруженоВсе then
      Result            = cmOk;
    end;
  end;--func Выполнение



inobject


end